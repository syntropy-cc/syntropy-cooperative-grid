# Syntropy Manager Service Installation Script for Windows
# This file is automatically generated during setup

$ServiceName = "SyntropyManager"
$DisplayName = "Syntropy Manager Service"
$BinPath = "{{ .Manager.HomeDir }}\bin\syntropy-manager.exe"
$Description = "Manages Syntropy network connections and configurations"
$ConfigPath = "{{ .Manager.DefaultPaths.config }}"

# Check if service exists
$service = Get-Service -Name $ServiceName -ErrorAction SilentlyContinue
if ($service) {
    Write-Host "Service $ServiceName already exists. Stopping and removing..."
    Stop-Service -Name $ServiceName -Force
    sc.exe delete $ServiceName
}

# Create new service
New-Service -Name $ServiceName -BinaryPathName "$BinPath --config $ConfigPath" -DisplayName $DisplayName -Description $Description -StartupType Automatic
Write-Host "Service $ServiceName installed successfully"

# Set recovery options
sc.exe failure $ServiceName reset= 86400 actions= restart/60000/restart/60000/restart/60000

# Start the service
Start-Service -Name $ServiceName
Write-Host "Service $ServiceName started"